!function(){function t(){return T("token.settings")}function e(){z.Authorization+=u("token")||t();var e=$.ajax({url:b,headers:z,cache:!1,type:"POST",contentType:"application/json",dataType:"json"}),n=$.ajax({url:x,headers:z,cache:!1,contentType:"application/json",dataType:"json"}),i=$.ajax({url:I,headers:z,cache:!1,contentType:"application/json",dataType:"json"});return $.when(i,e,n).done(function(t,e,n){j.manifest=o(t[0]),j.user=r(e[0]),j.settings=c(n[0]),j.isInited=!0})}function n(){if(!j.isInited)throw"Sorry, but you've tried to use api before it was initialized"}function i(){return n(),j.manifest}function a(){return n(),j.user}function s(){return n(),j.settings}function o(t){if(t&&t.languages&&t.languages.length>0)for(var e=0;e<t.languages.length;e++)t.languages[e].url=S+t.languages[e].url;return t}function r(t){t=t.data;var e=new w(m.free);return t.subscription&&t.subscription.accessType&&t.subscription.accessType>=m.starter&&new Date(t.subscription.expirationDate)>=new Date&&(e.accessType=t.subscription.accessType),e}function c(t){var e;return e=t.settings&&t.settings.length>0?JSON.parse(t.settings):{}}function u(t){var e=RegExp(t+"=(.+?)(&|$)").exec(location.search)||null;return null===e?null:decodeURI(e[1])}function p(t,e,n,i){f();var a={settings:t,extraSettings:e},s={url:x,type:"POST",headers:z,cache:!1,dataType:"json",data:a};return $.ajax(s).done(function(){l(n,!0)}).fail(function(){l(i,!1)}).always(function(){g()})}function f(){y({type:"freeze-editor"})}function g(){y({type:"unfreeze-editor"})}function l(t,e){y({type:"notification",data:{success:e,message:t}})}function d(){y({type:"upgrade-popup",data:{type:"certificates"}})}function h(){y({type:"show-settings"})}function y(t){var e=window.parent;e.postMessage(t,"*")}function T(t){for(var e=t+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var a=n[i];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(e))return a.substring(e.length,a.length)}}function w(t){this.accessType=t,this.hasTeamAccess=function(){return this.accessType>=m.team&&this.accessType!==m.academy}}var j={isInited:!1},m={free:0,starter:1,team:4,academy:5},v=location.protocol+"//"+location.host,b=v+"/auth/identity",x=v+"/api/course/"+u("courseId")+"/template/"+u("templateId"),S=location.toString().substring(0,location.toString().indexOf("/settings/"))+"/",I=S+"manifest.json",z={Authorization:"Bearer "};window.egApi={init:e,getManifest:i,getUser:a,getSettings:s,saveSettings:p,sendNotificationToEditor:l,showSettings:h,showCertificatesUpgradePopup:d}}();